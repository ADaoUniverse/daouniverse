import { ethers } from "ethers";

import { appName, token } from "../../Constants";

// methods to setup safe
import safeAbi from "../../abi/gnosis/safe.json";
// interaction with contract
import proxyFactoryAbi from "../../abi/gnosis/proxy_factory.json";
import fallbackAbi from "../../abi/gnosis/fallback_handler.json";
import createCallAbi from "../../abi/gnosis/create_call.json";

import Txn from "../Txn";

import Token from "../token/Token";

class Gnosis {
  constructor() {
    this.init();
    this.tokenHelper = new Token();
  }

  init() {
    this.safeInterface = new ethers.utils.Interface(safeAbi.abi);
    this.contractFactory = new ethers.Contract(this._getFactoryAddress(), proxyFactoryAbi.abi, window[appName].wallet);
    this.createCallInterface = new ethers.utils.Interface(createCallAbi.abi);
  }

  async createSafe(owners, threshold) {
    const res = await Txn.sendTxn(
      this.contractFactory,
      "createProxyWithNonce",
      this._getSafeAddress(),
      this._getSafeSetupData(owners, threshold),
      new Date().getTime(),
      {
        gasLimit: 500000,
      }
    );
    console.log(res);
    return res;
  }

  async deployContract(safeAddress, contractParams) {
    // cannot use ethers.Contract because the safeAddress is actually safeProxy address with fallback doing the delegation
    const signer = await window[appName].wallet.getSigner();
    const res = await signer.sendTransaction({
      to: safeAddress,
      data: this.safeInterface.encodeFunctionData("execTransaction", [
        this._getCreateCallContractAddress(),
        0,
        this._getPerformCreateData(contractParams),
        0,
        0,
        0,
        10000000,
        "0x0000000000000000000000000000000000000000",
        "0x0000000000000000000000000000000000000000",
        "0x000000000000000000000000E52772e599b3fa747Af9595266b527A31611cebd000000000000000000000000000000000000000000000000000000000000000001"
        // await signer.signMessage(ethers.utils.hashMessage("I approve")),
      ]),
      gasLimit: 10000000,
    });
    // const safeProxy = new ethers.Contract(safeAddress, safeProxyAbi, window[appName].wallet.getSigner());
    // const unsigned = await safeProxy.execTransaction(
    //   ,
    //   {
    //     gasLimit: 500000,
    //   }
    // );
    // const res = await window[appName].wallet.getSigner().sendTransaction(unsigned);
    // const safeContract = new ethers.Contract(safeAddress, safeAbi.abi, window[appName].wallet.getSigner());
    // const safeContract = new ethers.Contract(safeAddress, safeAbi.abi, window[appName].wallet.getSigner());
    // const res = await Txn.sendTxn(
    //   safeProxy,
    //   "execTransaction",
    //   this._getCreateCallContractAddress(),
    //   0,
    //   this._getPerformCreateData(contractParams),
    //   0,
    //   0,
    //   0,
    //   0,
    //   0,
    //   window[appName].account,
    //   {
    //     gasLimit: 500000,
    //   }
    // );
    console.log(res);
    return res;
  }

  _getSafeSetupData(owners, threshold) {
    return this.safeInterface.encodeFunctionData("setup", [
      owners,
      threshold,
      "0x0000000000000000000000000000000000000000",
      "0x",
      this._getFallbackAddress(),
      "0x0000000000000000000000000000000000000000",
      "0",
      "0x0000000000000000000000000000000000000000",
    ]);
  }

  _getPerformCreateData(contractParams) {
    // return "0x4c8c9ea100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000375060806040523480156200001157600080fd5b506040516200373038038062003730833981016040819052620000349162000482565b604080518082018252600881526714da1a5c1e585c9960c21b6020808301918252835180850190945260048452630534849560e41b9084015281519192916200008091600391620003ce565b50805162000096906004906020840190620003ce565b50506005805460ff191690555060405181903090620000b5906200045d565b6001600160a01b03928316815291166020820152604001604051809103906000f080158015620000e9573d6000803e3d6000fd5b50600880546001600160a01b0319166001600160a01b03929092169190911790556200013b8162000118601290565b6200012590600a6200051a565b62000135906305f5e10062000605565b620001a5565b620001486000826200028f565b60085462000181907f4f95d38bdf1c10f97389d9165d78fbae18ad4454e53a8ce330a76ca571454f85906001600160a01b03166200028f565b6200018b62000333565b506008805460ff60a81b1916600160a81b1790556200067a565b6001600160a01b038216620002015760405162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f20616464726573730060448201526064015b60405180910390fd5b8060026000828254620002159190620004b2565b90915550506001600160a01b0382166000908152602081905260408120805483929062000244908490620004b2565b90915550506040518181526001600160a01b038316906000907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a35b5050565b60008281526006602090815260408083206001600160a01b038516845290915290205460ff166200028b5760008281526006602090815260408083206001600160a01b03851684529091529020805460ff19166001179055620002ef3390565b6001600160a01b0316816001600160a01b0316837f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d60405160405180910390a45050565b60055460ff16156200037b5760405162461bcd60e51b815260206004820152601060248201526f14185d5cd8589b194e881c185d5cd95960821b6044820152606401620001f8565b6005805460ff191660011790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a258620003b13390565b6040516001600160a01b03909116815260200160405180910390a1565b828054620003dc9062000627565b90600052602060002090601f0160209004810192826200040057600085556200044b565b82601f106200041b57805160ff19168380011785556200044b565b828001600101855582156200044b579182015b828111156200044b5782518255916020019190600101906200042e565b50620004599291506200046b565b5090565b61168080620020b083390190565b5b808211156200045957600081556001016200046c565b60006020828403121562000494578081fd5b81516001600160a01b0381168114620004ab578182fd5b9392505050565b60008219821115620004c857620004c862000664565b500190565b80825b6001808611620004e1575062000511565b818704821115620004f657620004f662000664565b808616156200050457918102915b9490941c938002620004d0565b94509492505050565b6000620004ab60001960ff8516846000826200053957506001620004ab565b816200054857506000620004ab565b81600181146200056157600281146200056c57620005a0565b6001915050620004ab565b60ff84111562000580576200058062000664565b6001841b91508482111562000599576200059962000664565b50620004ab565b5060208310610133831016604e8410600b8410161715620005d8575081810a83811115620005d257620005d262000664565b620004ab565b620005e78484846001620004cd565b808604821115620005fc57620005fc62000664565b02949350505050565b600081600019048311821515161562000622576200062262000664565b500290565b6002810460018216806200063c57607f821691505b602082108114156200065e57634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fd5b611a26806200068a6000396000f3fe608060405234801561001057600080fd5b50600436106101f05760003560e01c806370a082311161010f578063a217fddf116100a2578063c1a287e211610071578063c1a287e214610433578063c6ad32001461043d578063d547741f14610451578063dd62ed3e14610464576101f0565b8063a217fddf146103f1578063a457c2d7146103f9578063a9059cbb1461040c578063bb4a1d3a1461041f576101f0565b806389d67872116100de57806389d67872146103a057806391d14854146103a857806395d89b41146103e15780639dbf326e146103e9576101f0565b806370a082311461035e5780637735d3d614610387578063786716fe1461038f5780638456cb5914610398576101f0565b80632ff2e9dc116101875780633f4ba83a116101565780633f4ba83a1461030d57806340c10f19146103155780635c975abb146103285780635d45220114610333576101f0565b80632ff2e9dc146102cd578063313ce567146102d857806336568abe146102e757806339509351146102fa576101f0565b806318160ddd116101c357806318160ddd1461027a57806323b872dd14610282578063248a9ca3146102955780632f2ff15d146102b8576101f0565b806301ffc9a7146101f557806306fdde031461021d578063095ea7b3146102325780630ade7dc114610245575b600080fd5b610208610203366004611831565b61049d565b60405190151581526020015b60405180910390f35b610225610538565b60405161021491906118f2565b6102086102403660046117ce565b6105ca565b61026c7f4f95d38bdf1c10f97389d9165d78fbae18ad4454e53a8ce330a76ca571454f8581565b604051908152602001610214565b60025461026c565b610208610290366004611793565b6105e2565b61026c6102a33660046117f7565b60009081526006602052604090206001015490565b6102cb6102c636600461180f565b610632565b005b61026c6305f5e10081565b60405160128152602001610214565b6102cb6102f536600461180f565b61065e565b6102086103083660046117ce565b6106ef565b6102cb61072e565b6102cb6103233660046117ce565b61079f565b60055460ff16610208565b600854610346906001600160a01b031681565b6040516001600160a01b039091168152602001610214565b61026c61036c366004611747565b6001600160a01b031660009081526020819052604090205490565b6102cb61088f565b61026c60075481565b6102cb61098e565b6102cb6109fc565b6102086103b636600461180f565b60009182526006602090815260408084206001600160a01b0393909316845291905290205460ff1690565b610225610a33565b6102cb610a42565b61026c600081565b6102086104073660046117ce565b610b65565b61020861041a3660046117ce565b610c1a565b60085461020890600160a81b900460ff1681565b61026c6201518081565b60085461020890600160a01b900460ff1681565b6102cb61045f36600461180f565b610c28565b61026c610472366004611761565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b60007fffffffff0000000000000000000000000000000000000000000000000000000082167f7965db0b00000000000000000000000000000000000000000000000000000000148061053057507f01ffc9a7000000000000000000000000000000000000000000000000000000007fffffffff000000000000000000000000000000000000000000000000000000008316145b90505b919050565b6060600380546105479061199f565b80601f01602080910402602001604051908101604052809291908181526020018280546105739061199f565b80156105c05780601f10610595576101008083540402835291602001916105c0565b820191906000526020600020905b8154815290600101906020018083116105a357829003601f168201915b5050505050905090565b6000336105d8818585610c4e565b5060019392505050565b60006105f060055460ff1690565b80156106055750600854600160a81b900460ff165b1561061d57610615848484610da6565b50600161062b565b610628848484610ea2565b90505b9392505050565b60008281526006602052604090206001015461064f81335b610ebb565b6106598383610f3b565b505050565b6001600160a01b03811633146106e15760405162461bcd60e51b815260206004820152602f60248201527f416363657373436f6e74726f6c3a2063616e206f6e6c792072656e6f756e636560448201527f20726f6c657320666f722073656c66000000000000000000000000000000000060648201526084015b60405180910390fd5b6106eb8282610fdd565b5050565b3360008181526001602090815260408083206001600160a01b03871684529091528120549091906105d89082908690610729908790611925565b610c4e565b600061073a813361064a565b600854600160a01b900460ff16156107945760405162461bcd60e51b815260206004820152601560248201527f434f4e54524143545f49535f5045524d414e454e54000000000000000000000060448201526064016106d8565b61079c611060565b50565b600854600160a01b900460ff1680156107ba575060055460ff165b156108075760405162461bcd60e51b815260206004820152601260248201527f5045524d414e454e544c595f504155534544000000000000000000000000000060448201526064016106d8565b3360009081527f3195c024b2ddd6d9b8f6c836aa52f67fe69376c8903d009b80229b3ce4425f51602052604090205460ff166108855760405162461bcd60e51b815260206004820152601360248201527f4e4f545f414c4c4f5745445f544f5f4d494e540000000000000000000000000060448201526064016106d8565b6106eb82826110fc565b600061089b813361064a565b600854600160a01b900460ff16156108f55760405162461bcd60e51b815260206004820152601160248201527f414c52454144595f5045524d414e454e5400000000000000000000000000000060448201526064016106d8565b6008805460ff60a01b1916600160a01b1790556109156201518042611925565b60075560055460ff161561079c57600860009054906101000a90046001600160a01b03166001600160a01b031663c2ad6c586040518163ffffffff1660e01b8152600401600060405180830381600087803b15801561097357600080fd5b505af1158015610987573d6000803e3d6000fd5b5050505050565b600061099a813361064a565b600854600160a01b900460ff16156109f45760405162461bcd60e51b815260206004820152601560248201527f434f4e54524143545f49535f5045524d414e454e54000000000000000000000060448201526064016106d8565b61079c6111dc565b6000610a08813361064a565b50600880547fffffffffffffffffffff00ffffffffffffffffffffffffffffffffffffffffff169055565b6060600480546105479061199f565b6000610a4e813361064a565b600854600160a01b900460ff16610aa75760405162461bcd60e51b815260206004820152600d60248201527f4e4f545f5045524d414e454e540000000000000000000000000000000000000060448201526064016106d8565b6007544210610af85760405162461bcd60e51b815260206004820152600b60248201527f43414e4e4f545f554e444f00000000000000000000000000000000000000000060448201526064016106d8565b6008805460ff60a01b19169055600060075560055460ff161561079c57600860009054906101000a90046001600160a01b03166001600160a01b031663e8d43d9e6040518163ffffffff1660e01b8152600401600060405180830381600087803b15801561097357600080fd5b3360008181526001602090815260408083206001600160a01b038716845290915281205490919083811015610c025760405162461bcd60e51b815260206004820152602560248201527f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760448201527f207a65726f00000000000000000000000000000000000000000000000000000060648201526084016106d8565b610c0f8286868403610c4e565b506001949350505050565b6000336105d8818585610da6565b600082815260066020526040902060010154610c44813361064a565b6106598383610fdd565b6001600160a01b038316610cc95760405162461bcd60e51b8152602060048201526024808201527f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460448201527f726573730000000000000000000000000000000000000000000000000000000060648201526084016106d8565b6001600160a01b038216610d455760405162461bcd60e51b815260206004820152602260248201527f45524332303a20617070726f766520746f20746865207a65726f20616464726560448201527f737300000000000000000000000000000000000000000000000000000000000060648201526084016106d8565b6001600160a01b0383811660008181526001602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925910160405180910390a3505050565b600854600160a01b900460ff168015610dc1575060055460ff165b15610e0e5760405162461bcd60e51b815260206004820152601260248201527f5045524d414e454e544c595f504155534544000000000000000000000000000060448201526064016106d8565b60055460ff1615610e97573360009081527f252bc27aa97cbf7f3d74e8e9122c0a34bdc9a2e0b717dd9f512e070400cf059b602052604090205460ff16610e975760405162461bcd60e51b815260206004820152601760248201527f4e4f545f414c4c4f5745445f544f5f5452414e5346455200000000000000000060448201526064016106d8565b610659838383611264565b600033610eb085828561147d565b610c0f858585610da6565b60008281526006602090815260408083206001600160a01b038516845290915290205460ff166106eb57610ef9816001600160a01b03166014611509565b610f04836020611509565b604051602001610f15929190611871565b60408051601f198184030181529082905262461bcd60e51b82526106d8916004016118f2565b60008281526006602090815260408083206001600160a01b038516845290915290205460ff166106eb5760008281526006602090815260408083206001600160a01b03851684529091529020805460ff19166001179055610f993390565b6001600160a01b0316816001600160a01b0316837f2f8788117e7eff1d82e926ec794901d17c78024a50270940304540a733656f0d60405160405180910390a45050565b60008281526006602090815260408083206001600160a01b038516845290915290205460ff16156106eb5760008281526006602090815260408083206001600160a01b0385168085529252808320805460ff1916905551339285917ff6391f5c32d9c69d2a47ea670b442974b53935d1edc7fd64eb21e047a839171b9190a45050565b60055460ff166110b25760405162461bcd60e51b815260206004820152601460248201527f5061757361626c653a206e6f742070617573656400000000000000000000000060448201526064016106d8565b6005805460ff191690557f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa335b6040516001600160a01b03909116815260200160405180910390a1565b6001600160a01b0382166111525760405162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f20616464726573730060448201526064016106d8565b80600260008282546111649190611925565b90915550506001600160a01b03821660009081526020819052604081208054839290611191908490611925565b90915550506040518181526001600160a01b038316906000907fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9060200160405180910390a36106eb565b60055460ff161561122f5760405162461bcd60e51b815260206004820152601060248201527f5061757361626c653a207061757365640000000000000000000000000000000060448201526064016106d8565b6005805460ff191660011790557f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a2586110df3390565b6001600160a01b0383166112e05760405162461bcd60e51b815260206004820152602560248201527f45524332303a207472616e736665722066726f6d20746865207a65726f20616460448201527f647265737300000000000000000000000000000000000000000000000000000060648201526084016106d8565b6001600160a01b03821661135c5760405162461bcd60e51b815260206004820152602360248201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260448201527f657373000000000000000000000000000000000000000000000000000000000060648201526084016106d8565b6001600160a01b038316600090815260208190526040902054818110156113eb5760405162461bcd60e51b815260206004820152602660248201527f45524332303a207472616e7366657220616d6f756e742065786365656473206260448201527f616c616e6365000000000000000000000000000000000000000000000000000060648201526084016106d8565b6001600160a01b03808516600090815260208190526040808220858503905591851681529081208054849290611422908490611925565b92505081905550826001600160a01b0316846001600160a01b03167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef8460405161146e91815260200190565b60405180910390a35b50505050565b6001600160a01b03838116600090815260016020908152604080832093861683529290522054600019811461147757818110156114fc5760405162461bcd60e51b815260206004820152601d60248201527f45524332303a20696e73756666696369656e7420616c6c6f77616e636500000060448201526064016106d8565b6114778484848403610c4e565b6060600061151883600261193d565b611523906002611925565b67ffffffffffffffff81111561154957634e487b7160e01b600052604160045260246000fd5b6040519080825280601f01601f191660200182016040528015611573576020820181803683370190505b5090507f3000000000000000000000000000000000000000000000000000000000000000816000815181106115b857634e487b7160e01b600052603260045260246000fd5b60200101906001600160f81b031916908160001a9053507f78000000000000000000000000000000000000000000000000000000000000008160018151811061161157634e487b7160e01b600052603260045260246000fd5b60200101906001600160f81b031916908160001a905350600061163584600261193d565b611640906001611925565b90505b60018111156116e1577f303132333435363738396162636465660000000000000000000000000000000085600f166010811061168f57634e487b7160e01b600052603260045260246000fd5b1a60f81b8282815181106116b357634e487b7160e01b600052603260045260246000fd5b60200101906001600160f81b031916908160001a90535060049490941c936116da81611988565b9050611643565b50831561062b5760405162461bcd60e51b815260206004820181905260248201527f537472696e67733a20686578206c656e67746820696e73756666696369656e7460448201526064016106d8565b80356001600160a01b038116811461053357600080fd5b600060208284031215611758578081fd5b61062b82611730565b60008060408385031215611773578081fd5b61177c83611730565b915061178a60208401611730565b90509250929050565b6000806000606084860312156117a7578081fd5b6117b084611730565b92506117be60208501611730565b9150604084013590509250925092565b600080604083850312156117e0578182fd5b6117e983611730565b946020939093013593505050565b600060208284031215611808578081fd5b5035919050565b60008060408385031215611821578182fd5b8235915061178a60208401611730565b600060208284031215611842578081fd5b81357fffffffff000000000000000000000000000000000000000000000000000000008116811461062b578182fd5b60007f416363657373436f6e74726f6c3a206163636f756e7420000000000000000000825283516118a981601785016020880161195c565b7f206973206d697373696e6720726f6c652000000000000000000000000000000060179184019182015283516118e681602884016020880161195c565b01602801949350505050565b600060208252825180602084015261191181604085016020870161195c565b601f01601f19169190910160400192915050565b60008219821115611938576119386119da565b500190565b6000816000190483118215151615611957576119576119da565b500290565b60005b8381101561197757818101518382015260200161195f565b838111156114775750506000910152565b600081611997576119976119da565b506000190190565b6002810460018216806119b357607f821691505b602082108114156119d457634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052601160045260246000fdfea264697066735822122023254e557e08076d15ca659f25a97282aa950714f3edf1448f729425ca95e13364736f6c6343000802003360806040523480156200001157600080fd5b506040516200168038038062001680833981016040819052620000349162000196565b6200003f3362000071565b6200004a82620000c1565b600180546001600160a01b0319166001600160a01b039290921691909117905550620001ea565b600080546001600160a01b038381166001600160a01b0319831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b6000546001600160a01b03163314620001215760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e657260448201526064015b60405180910390fd5b6001600160a01b038116620001885760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b606482015260840162000118565b620001938162000071565b50565b60008060408385031215620001a9578182fd5b8251620001b681620001d4565b6020840151909250620001c981620001d4565b809150509250929050565b6001600160a01b03811681146200019357600080fd5b61148680620001fa6000396000f3fe608060405234801561001057600080fd5b50600436106101365760003560e01c80637a09738f116100b2578063d0eff4f211610081578063e8d43d9e11610066578063e8d43d9e14610277578063ebf0c7171461027f578063f2fde38b1461028857610136565b8063d0eff4f214610250578063d98bebb91461025a57610136565b80637a09738f1461021a5780638da5cb5b1461022d578063b87592f21461023e578063c2ad6c581461024857610136565b80634d6c80e0116101095780635f221bfe116100ee5780635f221bfe146101c7578063624601b6146101f2578063715018a61461021257610136565b80634d6c80e0146101a157806351816591146101b457610136565b8063013eba921461013b57806315e6bb2b1461016e578063440bc7f314610179578063482017d11461018e575b600080fd5b61015b61014936600461125d565b60056020526000908152604090205481565b6040519081526020015b60405180910390f35b61015b63058fd40081565b61018c6101873660046112bc565b61029b565b005b61018c61019c3660046112d4565b610388565b61015b6101af3660046112d4565b6107bd565b61015b6101c23660046112d4565b6109cb565b6001546101da906001600160a01b031681565b6040516001600160a01b039091168152602001610165565b61015b61020036600461125d565b60046020526000908152604090205481565b61018c610c64565b61015b6102283660046112d4565b610cca565b6000546001600160a01b03166101da565b61015b62ed4e0081565b61018c610e16565b61015b6276a70081565b6003546102679060ff1681565b6040519015158152602001610165565b61018c610e7f565b61015b60025481565b61018c61029636600461125d565b610ee5565b6000546001600160a01b031633146102fa5760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e657260448201526064015b60405180910390fd5b60035460ff161561034d5760405162461bcd60e51b815260206004820152601260248201527f5045524d414e454e544c595f504155534544000000000000000000000000000060448201526064016102f1565b60028190556040518181527f136c0469109f45a2bf2f764309926b484a507d7645843502b6a6a68b2e5dc0eb9060200160405180910390a150565b60035460ff16156103db5760405162461bcd60e51b815260206004820152601260248201527f5045524d414e454e544c595f504155534544000000000000000000000000000060448201526064016102f1565b80336103ed60e0830160c0840161125d565b6001600160a01b0316146104345760405162461bcd60e51b815260206004820152600e60248201526d1393d517d055551213d49256915160921b60448201526064016102f1565b61055d61051c602083013561044f606085016040860161130c565b61045f608086016060870161130c565b61046f60a0870160808801611284565b61047f60c0880160a08901611284565b61048f60e0890160c08a0161125d565b6040805160208082019890985260e096871b7fffffffff00000000000000000000000000000000000000000000000000000000908116828401529590961b909416604486015291151560f890811b6048860152901515901b604984015260601b6bffffffffffffffffffffffff1916604a8301528051603e818403018152605e9092019052805191012090565b6105268380611330565b80806020026020016040519081016040528093929190818152602001838360200280828437600092019190915250610fc792505050565b6105985760405162461bcd60e51b815260206004820152600c60248201526b1110551057d253959053125160a21b60448201526064016102f1565b6105a8608082016060830161130c565b63ffffffff161561062a5763058fd4006105c8606083016040840161130c565b6105d8608084016060850161130c565b6105e291906113ec565b63ffffffff16111561062a5760405162461bcd60e51b815260206004820152601160248201527014d513d417d110551157d2539590531251607a1b60448201526064016102f1565b600061063583610fd6565b9050600081116106875760405162461bcd60e51b815260206004820152601260248201527f4e4f5f544f4b454e535f544f5f434c41494d000000000000000000000000000060448201526064016102f1565b33600090815260046020526040812080548392906106a690849061137e565b90915550506001546001600160a01b03166323b872dd6106ce6000546001600160a01b031690565b6040517fffffffff0000000000000000000000000000000000000000000000000000000060e084901b1681526001600160a01b03909116600482015233602482015260448101849052606401602060405180830381600087803b15801561073457600080fd5b505af1158015610748573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061076c91906112a0565b5033600081815260056020908152604091829020429055815192835282018390527fd8138f8a3f377c5259ca548e70e4c2de94f129f5a11036a15b69513cba2b426a910160405180910390a1505050565b600081336107d160e0830160c0840161125d565b6001600160a01b0316146108185760405162461bcd60e51b815260206004820152600e60248201526d1393d517d055551213d49256915160921b60448201526064016102f1565b61083361051c602083013561044f606085016040860161130c565b61086e5760405162461bcd60e51b815260206004820152600c60248201526b1110551057d253959053125160a21b60448201526064016102f1565b61087e608082016060830161130c565b63ffffffff16156109005763058fd40061089e606083016040840161130c565b6108ae608084016060850161130c565b6108b891906113ec565b63ffffffff1611156109005760405162461bcd60e51b815260206004820152601160248201527014d513d417d110551157d2539590531251607a1b60448201526064016102f1565b610910608084016060850161130c565b63ffffffff166109405733600090815260046020908152604090912054610939918501356113d5565b91506109c5565b42610951608085016060860161130c565b63ffffffff1610156109665761093983610fd6565b600061099c61097b608086016060870161130c565b63ffffffff16610991606087016040880161130c565b63ffffffff16611100565b336000908152600460209081526040909120549192506109c19183918701359061110c565b9250505b50919050565b600081336109df60e0830160c0840161125d565b6001600160a01b031614610a265760405162461bcd60e51b815260206004820152600e60248201526d1393d517d055551213d49256915160921b60448201526064016102f1565b610a4161051c602083013561044f606085016040860161130c565b610a7c5760405162461bcd60e51b815260206004820152600c60248201526b1110551057d253959053125160a21b60448201526064016102f1565b610a8c608082016060830161130c565b63ffffffff1615610b0e5763058fd400610aac606083016040840161130c565b610abc608084016060850161130c565b610ac691906113ec565b63ffffffff161115610b0e5760405162461bcd60e51b815260206004820152601160248201527014d513d417d110551157d2539590531251607a1b60448201526064016102f1565b33600090815260046020908152604090912054908401351415610b3457600091506109c5565b33600090815260056020526040812054610b98576276a700610b5c606086016040870161130c565b63ffffffff16610b6c919061137e565b9050610b7e60c0850160a08601611284565b15610b9357610b906276a7008261137e565b90505b610c16565b60006276a700610bae606087016040880161130c565b33600090815260056020526040902054610bce9163ffffffff16906113d5565b610bd89190611396565b90506276a700610be881836113b6565b610bf8606088016040890161130c565b63ffffffff16610c08919061137e565b610c12919061137e565b9150505b610c26608085016060860161130c565b63ffffffff1615801590610c4e5750610c45608085016060860161130c565b63ffffffff1681115b15610c5d5760009250506109c5565b9392505050565b6000546001600160a01b03163314610cbe5760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e657260448201526064016102f1565b610cc8600061115d565b565b60008133610cde60e0830160c0840161125d565b6001600160a01b031614610d255760405162461bcd60e51b815260206004820152600e60248201526d1393d517d055551213d49256915160921b60448201526064016102f1565b610d4061051c602083013561044f606085016040860161130c565b610d7b5760405162461bcd60e51b815260206004820152600c60248201526b1110551057d253959053125160a21b60448201526064016102f1565b610d8b608082016060830161130c565b63ffffffff1615610e0d5763058fd400610dab606083016040840161130c565b610dbb608084016060850161130c565b610dc591906113ec565b63ffffffff161115610e0d5760405162461bcd60e51b815260206004820152601160248201527014d513d417d110551157d2539590531251607a1b60448201526064016102f1565b610c5d83610fd6565b6001546001600160a01b03163314610e705760405162461bcd60e51b815260206004820152600f60248201527f4f4e4c595f534849505f544f4b454e000000000000000000000000000000000060448201526064016102f1565b6003805460ff19166001179055565b6001546001600160a01b03163314610ed95760405162461bcd60e51b815260206004820152600f60248201527f4f4e4c595f534849505f544f4b454e000000000000000000000000000000000060448201526064016102f1565b6003805460ff19169055565b6000546001600160a01b03163314610f3f5760405162461bcd60e51b815260206004820181905260248201527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e657260448201526064016102f1565b6001600160a01b038116610fbb5760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201527f646472657373000000000000000000000000000000000000000000000000000060648201526084016102f1565b610fc48161115d565b50565b6000610c5d82600254856111c5565b6000610fe860a0830160808401611284565b610ff4575060006110fb565b6000611006608084016060850161130c565b63ffffffff16158061102c575042611024608085016060860161130c565b63ffffffff16115b1561104c5761104542610991606086016040870161130c565b9050611078565b61107561105f608085016060860161130c565b63ffffffff16610991606086016040870161130c565b90505b61108860c0840160a08501611284565b8015611096575062ed4e0081105b156110a55760009150506110fb565b63058fd4008110156110dc57336000908152600460209081526040909120546110d4918391908601359061110c565b9150506110fb565b336000908152600460209081526040909120546110d4918501356113d5565b919050565b6000610c5d82846113d5565b60008061111c6276a70086611396565b9050600063058fd4006276a70061113384886113b6565b61113d91906113b6565b6111479190611396565b905061115384826113d5565b9695505050505050565b600080546001600160a01b038381167fffffffffffffffffffffffff0000000000000000000000000000000000000000831681178455604051919092169283917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e09190a35050565b6000826111d285846111db565b14949350505050565b600081815b845181101561125557600085828151811061120b57634e487b7160e01b600052603260045260246000fd5b602002602001015190508083116112315760008381526020829052604090209250611242565b600081815260208490526040902092505b508061124d81611411565b9150506111e0565b509392505050565b60006020828403121561126e578081fd5b81356001600160a01b0381168114610c5d578182fd5b600060208284031215611295578081fd5b8135610c5d81611442565b6000602082840312156112b1578081fd5b8151610c5d81611442565b6000602082840312156112cd578081fd5b5035919050565b6000602082840312156112e5578081fd5b813567ffffffffffffffff8111156112fb578182fd5b820160e08185031215610c5d578182fd5b60006020828403121561131d578081fd5b813563ffffffff81168114610c5d578182fd5b6000808335601e19843603018112611346578283fd5b83018035915067ffffffffffffffff821115611360578283fd5b602090810192508102360382131561137757600080fd5b9250929050565b600082198211156113915761139161142c565b500190565b6000826113b157634e487b7160e01b81526012600452602481fd5b500490565b60008160001904831182151516156113d0576113d061142c565b500290565b6000828210156113e7576113e761142c565b500390565b600063ffffffff838116908316818110156114095761140961142c565b039392505050565b60006000198214156114255761142561142c565b5060010190565b634e487b7160e01b600052601160045260246000fd5b8015158114610fc457600080fdfea2646970667358221220835d6ad536ce0cb650c676b37824b9ed9b1c3e0b9b5e90afbe18a9593b2e674864736f6c63430008020033000000000000000000000000f2c2ed04432dbfb924d1b334b490e2f7ea91b56b00000000000000000000000000000000"
    return this.createCallInterface.encodeFunctionData("performCreate", [
      0,
      this.tokenHelper.getErc20TokenContractEncoded(...contractParams),
    ]);
  }

  _getFactoryAddress() {
    return this._getAddress(proxyFactoryAbi);
  }

  _getSafeAddress() {
    return this._getAddress(safeAbi);
  }

  _getFallbackAddress() {
    return this._getAddress(fallbackAbi);
  }

  _getCreateCallContractAddress() {
    return this._getAddress(createCallAbi);
  }

  _getAddress(abi) {
    const address = abi.networkAddresses[window[appName].network.chainId];
    if (!address) throw "Network not supported";
    return address;
  }
}

export default Gnosis;

/**
 * signTransaction from metamask
 *
 * ownable erc20 is ERC20
 */
